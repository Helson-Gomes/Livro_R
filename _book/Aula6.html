<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; Manipulação de dados – Introdução à Programação e à Ciência de Dados</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./Aula5.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8da5b4427184b79ecddefad3d342027e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Aula6.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Manipulação de dados</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introdução à Programação e à Ciência de Dados</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prefácio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introdução</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./aula2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Indexação e operações indexadas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Aula3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Classes de elementos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Aula4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Condições, funções e loops</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Aula5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Leitura de dados</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Aula6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Manipulação de dados</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introdução" id="toc-introdução" class="nav-link active" data-scroll-target="#introdução"><span class="header-section-number">6.1</span> Introdução</a>
  <ul class="collapse">
  <li><a href="#bibliotecas-necessárias" id="toc-bibliotecas-necessárias" class="nav-link" data-scroll-target="#bibliotecas-necessárias"><span class="header-section-number">6.1.1</span> Bibliotecas necessárias</a></li>
  <li><a href="#a-função-pip" id="toc-a-função-pip" class="nav-link" data-scroll-target="#a-função-pip"><span class="header-section-number">6.1.2</span> A função <em>pip</em> (%&gt;%)</a></li>
  </ul></li>
  <li><a href="#união-de-bases-de-dados-join" id="toc-união-de-bases-de-dados-join" class="nav-link" data-scroll-target="#união-de-bases-de-dados-join"><span class="header-section-number">6.2</span> União de bases de dados <em>(join)</em></a>
  <ul class="collapse">
  <li><a href="#junção-à-esquerda-left_joinxy" id="toc-junção-à-esquerda-left_joinxy" class="nav-link" data-scroll-target="#junção-à-esquerda-left_joinxy"><span class="header-section-number">6.2.1</span> Junção à esquerda (<em>left_join(x,y)</em>)</a></li>
  <li><a href="#junção-à-direita-right_joinxy" id="toc-junção-à-direita-right_joinxy" class="nav-link" data-scroll-target="#junção-à-direita-right_joinxy"><span class="header-section-number">6.2.2</span> Junção à direita (<em>right_join(x,y)</em>)</a></li>
  <li><a href="#intersecção-inner_joinxy" id="toc-intersecção-inner_joinxy" class="nav-link" data-scroll-target="#intersecção-inner_joinxy"><span class="header-section-number">6.2.3</span> Intersecção (<em>inner_join(x,y)</em>)</a></li>
  <li><a href="#intersecção-semi_joinxy" id="toc-intersecção-semi_joinxy" class="nav-link" data-scroll-target="#intersecção-semi_joinxy"><span class="header-section-number">6.2.4</span> Intersecção (<em>semi_join(x,y)</em>)</a></li>
  <li><a href="#união-full_joinxy" id="toc-união-full_joinxy" class="nav-link" data-scroll-target="#união-full_joinxy"><span class="header-section-number">6.2.5</span> União (<em>full_join(x,y)</em>)</a></li>
  <li><a href="#exclusão-anti_joinxy" id="toc-exclusão-anti_joinxy" class="nav-link" data-scroll-target="#exclusão-anti_joinxy"><span class="header-section-number">6.2.6</span> Exclusão (<em>anti_join(x,y)</em>)</a></li>
  <li><a href="#exemplo-unindo-o-pib-e-a-população" id="toc-exemplo-unindo-o-pib-e-a-população" class="nav-link" data-scroll-target="#exemplo-unindo-o-pib-e-a-população"><span class="header-section-number">6.2.7</span> Exemplo: Unindo o pib e a população</a></li>
  </ul></li>
  <li><a href="#gerando-estatísticas-com-summarise" id="toc-gerando-estatísticas-com-summarise" class="nav-link" data-scroll-target="#gerando-estatísticas-com-summarise"><span class="header-section-number">6.3</span> Gerando estatísticas com <em>summarise</em></a>
  <ul class="collapse">
  <li><a href="#gerando-estatísticas-para-todas-as-colunas" id="toc-gerando-estatísticas-para-todas-as-colunas" class="nav-link" data-scroll-target="#gerando-estatísticas-para-todas-as-colunas"><span class="header-section-number">6.3.1</span> Gerando estatísticas para todas as colunas</a></li>
  <li><a href="#gerando-estatísticas-para-colunas-específicas" id="toc-gerando-estatísticas-para-colunas-específicas" class="nav-link" data-scroll-target="#gerando-estatísticas-para-colunas-específicas"><span class="header-section-number">6.3.2</span> Gerando estatísticas para colunas específicas</a></li>
  <li><a href="#gerando-estatísticas-condicionais" id="toc-gerando-estatísticas-condicionais" class="nav-link" data-scroll-target="#gerando-estatísticas-condicionais"><span class="header-section-number">6.3.3</span> Gerando estatísticas condicionais</a></li>
  </ul></li>
  <li><a href="#criando-variáveis-mutate" id="toc-criando-variáveis-mutate" class="nav-link" data-scroll-target="#criando-variáveis-mutate"><span class="header-section-number">6.4</span> Criando Variáveis (<em>mutate</em>)</a>
  <ul class="collapse">
  <li><a href="#adicionando-variáveis-multicategóricas-mutate-case_when" id="toc-adicionando-variáveis-multicategóricas-mutate-case_when" class="nav-link" data-scroll-target="#adicionando-variáveis-multicategóricas-mutate-case_when"><span class="header-section-number">6.4.1</span> Adicionando variáveis multicategóricas (<em>mutate + case_when</em>)</a></li>
  </ul></li>
  <li><a href="#filtrando-valores-nas-colunas" id="toc-filtrando-valores-nas-colunas" class="nav-link" data-scroll-target="#filtrando-valores-nas-colunas"><span class="header-section-number">6.5</span> Filtrando valores nas colunas</a></li>
  <li><a href="#selecionando-colunas-na-planilha-select" id="toc-selecionando-colunas-na-planilha-select" class="nav-link" data-scroll-target="#selecionando-colunas-na-planilha-select"><span class="header-section-number">6.6</span> Selecionando colunas na planilha (<em>select</em>)</a></li>
  <li><a href="#separando-valores-por-um-separador-comum" id="toc-separando-valores-por-um-separador-comum" class="nav-link" data-scroll-target="#separando-valores-por-um-separador-comum"><span class="header-section-number">6.7</span> Separando valores por um separador comum</a></li>
  <li><a href="#agrupando-valores-group_by" id="toc-agrupando-valores-group_by" class="nav-link" data-scroll-target="#agrupando-valores-group_by"><span class="header-section-number">6.8</span> Agrupando valores (<em>group_by</em>)</a>
  <ul class="collapse">
  <li><a href="#agrupando-toda-a-base-de-dados-group_by-summarise" id="toc-agrupando-toda-a-base-de-dados-group_by-summarise" class="nav-link" data-scroll-target="#agrupando-toda-a-base-de-dados-group_by-summarise"><span class="header-section-number">6.8.1</span> (1) agrupando toda a base de dados (<em>group_by + summarise</em>)</a></li>
  <li><a href="#preservando-toda-a-base-de-dados-group_by-mutate" id="toc-preservando-toda-a-base-de-dados-group_by-mutate" class="nav-link" data-scroll-target="#preservando-toda-a-base-de-dados-group_by-mutate"><span class="header-section-number">6.8.2</span> (2) Preservando toda a base de dados (<em>group_by + mutate</em>)</a></li>
  </ul></li>
  <li><a href="#transformando-colunas-em-variáveis-pivot_wider" id="toc-transformando-colunas-em-variáveis-pivot_wider" class="nav-link" data-scroll-target="#transformando-colunas-em-variáveis-pivot_wider"><span class="header-section-number">6.9</span> Transformando colunas em variáveis (<em>pivot_wider</em>)</a></li>
  <li><a href="#transformando-variáveis-em-colunas-pivot_longer" id="toc-transformando-variáveis-em-colunas-pivot_longer" class="nav-link" data-scroll-target="#transformando-variáveis-em-colunas-pivot_longer"><span class="header-section-number">6.10</span> Transformando variáveis em colunas (<em>pivot_longer</em>)</a></li>
  <li><a href="#exemplo-gerando-uma-tabela-de-estatísticas-descritivas" id="toc-exemplo-gerando-uma-tabela-de-estatísticas-descritivas" class="nav-link" data-scroll-target="#exemplo-gerando-uma-tabela-de-estatísticas-descritivas"><span class="header-section-number">6.11</span> Exemplo: Gerando uma tabela de estatísticas descritivas</a></li>
  <li><a href="#exercício" id="toc-exercício" class="nav-link" data-scroll-target="#exercício"><span class="header-section-number">6.12</span> Exercício</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Manipulação de dados</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introdução" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="introdução"><span class="header-section-number">6.1</span> Introdução</h2>
<p>Tendo conhecido os tópicos fundamentais a respeito da lógica de programação nos quatro primeiros capítulos e tendo em mãos os conhecimentos básicos a respeito da leitura de arquivos de dados com base no conteúdo visto no capítulo anterior, o próximo passo do aprendizado da introdução à programação e à ciência de dados é entender os fundamentos básicos da manipulação de dados.</p>
<p>Entende-se por manipulação de dados as técnicas necessárias para organizar bases de dados de acordo com um determinado objetivo, corrigindo erros, implementando melhorias e deixando-as com as propriedades desejadas. É fundamental que o economista domine as técnicas de manipulação de dados pois a etapa de tratamento das informações requer esse conhecimento e deve ser aplicada antes de qualquer análise empírica.</p>
<p>É comum que informações distintas estejam hospedadas em diferentes fontes. Mas também é comum que múltiplas bases de dados sejam necessárias para gerar uma única informação. Por exemplo, o pib per capita requer duas bases de dados, o pib e a população, as quais estão em diferentes fontes. Assim, o economista terá de importar ambas as bases de dados, uní-las em uma única planilha e em seguida fazer as devidas manipulações para transformar o pib e a população no pib per capita.</p>
<p>Por esse motivo, esse capítulo é subdividido em duas etapas fundamentais. Na primeira etapa, são repassadas as técnicas de junção de bases de dados, onde o aluno irá aprender a unir objetos sob diferentes perspectivas de união. Em seguida, na segunda etapa são repassadas as técnicas de manipulação de dados, onde o aluno aprenderá as principais ferramentas úteis no gerenciamento de informações.</p>
<section id="bibliotecas-necessárias" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="bibliotecas-necessárias"><span class="header-section-number">6.1.1</span> Bibliotecas necessárias</h3>
<p>Usaremos duas bibliotecas indispensáveis na manipulação de dados com <em>R</em>, a biblioteca <a href="https://dplyr.tidyverse.org/">dplyr</a> e a biblioteca <a href="https://tidyr.tidyverse.org/">tidyr</a>. Essas bibliotecas dispõem de funções úteis no gerenciamento de bases de dados que dão uma intérfase simples e compreensível às técnicas de gerenciamento de dados. Portanto, antes de mais nada é preciso instalar as bibliotecas e librerá-las para o uso.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>FALSE 
FALSE Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>FALSE The following objects are masked from 'package:stats':
FALSE 
FALSE     filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>FALSE The following objects are masked from 'package:base':
FALSE 
FALSE     intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] TRUE

[[2]]
[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="a-função-pip" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="a-função-pip"><span class="header-section-number">6.1.2</span> A função <em>pip</em> (%&gt;%)</h3>
<p>A biblioteca <em>tidyr</em> possui uma função que permite agrupar múltiplas linhas de comando em apenas um único comando. Essa função é conhecida como <em>pip</em> e o seu uso é ativado por meio do comando <em>%&gt;%</em>. Esse procedimento facilita a manipulação de dados uma vez que permite que múltiplas tarefas sejam executadas em um único bloco de ordens ao computador. Para exemplificar, considere a base nativa sobre carros <em>mtcars</em>. Suponha que queiramos preservar apenas os carros com câmbio automático e checar o consumo médio desses carros. Sem as bibliotecas de manipulação, essa tarefa seria realizada em duas linhas de comando separadamente, conforme demonstrado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> mtcars[mtcars<span class="sc">$</span>am <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dt<span class="sc">$</span>mpg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24.39231</code></pre>
</div>
</div>
<p>Com a função <em>pip,</em> é possível associar a segunda linha à primeira e criar um bloco de ordens em um único comando. Assim, o output gerado será o resultado das ordens indicadas no bloco de ordens. No caso do exemplo anterior, devemos dar a ordem para preservar apenas <em>am = 1</em>, acionamos o <em>pip</em> e em seguida ordenamos para calcular a média do consumo, conforme demonstrado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mtcars[mtcars<span class="sc">$</span>am <span class="sc">==</span> <span class="dv">1</span>,] <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">mean</span>(mpg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean(mpg)
1  24.39231</code></pre>
</div>
</div>
<p>Note que o resultado é o mesmo em ambas as abordagens.</p>
</section>
</section>
<section id="união-de-bases-de-dados-join" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="união-de-bases-de-dados-join"><span class="header-section-number">6.2</span> União de bases de dados <em>(join)</em></h2>
<p>Muitas vezes os economistas se deparam com a necessidade de unir bases de dados para obter informações úteis. Por exemplo, um economista que busca analisar o PIB <em>per capita</em> precisa operacionalizar com uma base de dados de crescimento (PIB) e uma base de dados sobre população. Um economista que busca estudar mercados de capitais pode precisar lidar com uma base de dados sobre preços de ações e outra base sobre taxas de câmbio. Em resumo, os economistas precisam lidar com múltiplas bases de dados e precisam conhecer as técnicas de junção de bases de dados distintas.</p>
<p>A biblioteca <em>dplyr</em> possui um conjunto de funções que facilita a união de bases de dados de acordo com a necessidade e a configuração dos dados. As junções de bases de dados devem ser feitas com base em um código de identificação dos indivíduos. Imagine que queiramos unir as duas tabelas a seguir:</p>
<p><span class="math display">\[
x = \left[\begin{array}{ccc}
ID &amp; X1 &amp; X2\\
1 &amp; A &amp; E\\
2 &amp; B &amp; F\\
3 &amp; C &amp; G\\
4 &amp; D &amp; H\\
\end{array}\right]
\quad \quad \quad  \quad
y = \left[\begin{array}{cc}
ID &amp; X3\\
1 &amp; I\\
3 &amp; J\\
5 &amp; K\\
\end{array}\right]
\]</span></p>
<p>Se <em>ID</em> é a identificação do indivíduo, então as duas tabelas podem ser unidas de acordo com essa identificação. No entanto, alguns elementos em <em>x</em> não estão disponíveis em <em>y</em> do mesmo modo que alguns elementos em <em>y</em> não estão disponíveis em <em>x</em>. É preciso, portanto, que o usuário saiba quais informações são do seu interesse em cada tabela para fazer a união das bases.</p>
<p>Baseado nisso, a biblioteca <em>dplyr</em> possui uma série de funções ideais para a junção de bases de dados que permite que o usuário una duas planilhas de acordo com um código de identificação e com base no procedimento ideal para a junção. Basicamente são seis tipos de junções que podem ser efetuadas. As funções e os tipos de junção possibilitados por essas funções estão listados a seguir:</p>
<ul>
<li><p><strong>left_join(x,y):</strong> Junção à esquerda. Mantém inalterados todos os indivíduos da tabela a esquerda (Tabela x) e posiciona os valores correspondentes da tabela da direita (Tavela y) à direita das colunas da primeira tabela.</p></li>
<li><p><strong>right_join(x,y):</strong> Junção à direita. Mantém inalterados todos os indivíduos da tabela a direita (Tabela y) e posiciona os valores correspondentes da tabela da esquerda (Tavela x) à direita das colunas da segunda tabela.</p></li>
<li><p><strong>inner_join(x,y):</strong> Intersecção. Gera uma tabela <em>z</em> com as colunas de <em>x</em> e <em>y</em> contendo apenas os indivíduos que possuem informações em ambas as tabelas.</p></li>
<li><p><strong>semi_join(x,y):</strong> Intersecção. Gera uma tabela semelhante à tabela <em>x</em>, sem as colunas da tabela <em>y</em>, porém, contendo apenas os indivíduos que estão presentes em <em>x</em> e <em>y.</em></p></li>
<li><p><strong>full_join(x,y):</strong> União de tabelas. Gera uma tabela com todas as colunas e todas as linhas de <em>x</em> e <em>y</em>. Nesse caso, todos os indivíduos presentes em <em>x</em> e <em>y</em> são preservados no output.</p></li>
<li><p><strong>anti_join(x,y):</strong> Gera uma tabela contendo todos os indivíduos da tabela <em>x</em> que não estão presentes na tabela <em>y</em>.</p></li>
</ul>
<p>Essas definições podem ser facilmente visualizadas na figura a seguir:</p>
<p><img src="images/join_diagram.png"></p>
<section id="junção-à-esquerda-left_joinxy" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="junção-à-esquerda-left_joinxy"><span class="header-section-number">6.2.1</span> Junção à esquerda (<em>left_join(x,y)</em>)</h3>
<p>Considere as tabelas <em>x</em> e <em>y</em> apresentadas anteriormente. Suponha que queiramos colocar a coluna <em>X3</em> da tabela <em>y</em> ao lado da coluna <em>X2</em> da tabela <em>x,</em> preservando todos os quatro indivíduos da tabela <em>x</em>. Nesse caso, podemos usar o <em>left_join()</em>, posicionando <em>x</em> à esquerda e <em>y</em> à direita. Para tanto, vamos digitar as tabelas como data frames e vamos nomeá-las de <em>“tabela1</em>” e “<em>tabela2</em>”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tabela1 <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">X1 =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="at">X2 =</span> LETTERS[<span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>tabela2 <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ID =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>), <span class="at">X3 =</span> LETTERS[<span class="dv">9</span><span class="sc">:</span><span class="dv">11</span>]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Agora vamos gerar uma <em>tabela3</em>, unindo as duas tabelas com o <em>left_join()</em>. Para tanto, precisamos indicar qual das tabelas será posicionada à esquerda e à direita nos parâmetros <em>x</em> e <em>y</em> da função, respectivamente, e também precisamos indicar o código de identificação do indivíduo entre aspas no parâmetro <em>by</em> da função. Esse procedimento pode ser feito conforme a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tabela3 <span class="ot">=</span> <span class="fu">left_join</span>(<span class="at">x =</span> tabela1, <span class="at">y =</span> tabela2, <span class="at">by =</span> <span class="st">"ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Esse procedimento gera um data frame com as seguintes propriedades:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tabela3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID X1 X2   X3
1  1  A  E    I
2  2  B  F &lt;NA&gt;
3  3  C  G    J
4  4  D  H &lt;NA&gt;</code></pre>
</div>
</div>
<p>Note que os indivíduos com ID 2 e 4 apresentam valores <em>NA</em> na coluna <em>X3</em>. Isso ocorre porque esses indivíduos não estão presentes na <em>tabela2</em> e mesmo assim permanecem no output. Como não existem valores de referência para esses indivíduos nessa coluna, a linguagem retorna valores vazios.</p>
</section>
<section id="junção-à-direita-right_joinxy" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="junção-à-direita-right_joinxy"><span class="header-section-number">6.2.2</span> Junção à direita (<em>right_join(x,y)</em>)</h3>
<p>Suponha agora que precisamos preservar apenas os indivíduos da <em>tabela2</em>, colocando as colunas da <em>tabela1</em> à direita das colunas da <em>tabela2</em>. Nesse caso, o ideal é usar o <em>right-join()</em>. Nesse tipo de junção, o parâmetro <em>y</em> indica qual planilha permanecerá com as linhas inteiramente preservadas, ao passo que o parâmetro <em>x</em> mostra a planilha que aparecerá à esquerda da <em>tabela2</em> no output. Esse procedimento pode ser feito conforme indicado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tabela3 <span class="ot">=</span> <span class="fu">right_join</span>(<span class="at">x =</span> tabela1, <span class="at">y =</span> tabela2, <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tabela3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID   X1   X2 X3
1  1    A    E  I
2  3    C    G  J
3  5 &lt;NA&gt; &lt;NA&gt;  K</code></pre>
</div>
</div>
<p>Note que agora as colunas <em>X1</em> e <em>X2</em> apresentam <em>NA</em>s para o indivíduo 5. Isso ocorre porque esse indivíduo não está presente na <em>tabela1</em> mas está presente na <em>tabela2</em>. Como todas as linhas da <em>tabela2</em> são preservadas nesse tipo de junção, então a linguagem atribui valores vazios para essas células.</p>
</section>
<section id="intersecção-inner_joinxy" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="intersecção-inner_joinxy"><span class="header-section-number">6.2.3</span> Intersecção (<em>inner_join(x,y)</em>)</h3>
<p>Considere agora o caso em que seja necessário preservar no output apenas os indivíduos que estão tanto na <em>tabela1</em> quanto na <em>tabela2</em>. Nesse caso, o ideal é fazer uma intersecção usando o <em>inner_join()</em>. A planilha resultante irá mostrar as colunas de ambas as tabelas, porém, contendo apenas as linhas comuns às duas planilhas. Esse procedimento pode ser feito conforme demonstrado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>tabela3 <span class="ot">=</span> <span class="fu">inner_join</span>(<span class="at">x =</span> tabela1, <span class="at">y =</span> tabela2, <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tabela3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID X1 X2 X3
1  1  A  E  I
2  3  C  G  J</code></pre>
</div>
</div>
<p>Note que o output resultante só possui os indivíduos 1 e 2. Isso ocorre porque esses são os únicos indivíduos que estão nas duas planilhas.</p>
</section>
<section id="intersecção-semi_joinxy" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="intersecção-semi_joinxy"><span class="header-section-number">6.2.4</span> Intersecção (<em>semi_join(x,y)</em>)</h3>
<p>Considere agora o caso em que seja necessário preservar apenas os indivíduos que estão presentes em ambas as planilhas assim como no caso anterior. Porém, considere que não seja necessário preservar as colunas da <em>tabela2</em> no output, isto é, estamos interessados em preservar apenas as colunas da <em>tabela1</em>, mas mantendo apenas as linhas referentes aos indivíduos que estão presentes em ambas as planilhas. Nesse caso, o ideal é usar o <em>semi_join()</em>, procedendo conforme demonstrado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>tabela3 <span class="ot">=</span> <span class="fu">semi_join</span>(<span class="at">x =</span> tabela1, <span class="at">y =</span> tabela2, <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tabela3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID X1 X2
1  1  A  E
2  3  C  G</code></pre>
</div>
</div>
<p>Repare que apenas os indivíduos 1 e 2 são preservados no output, assim como no caso do <em>inner_join()</em>. Porém, note que agora a coluna <em>X3</em> não aparece no output.</p>
</section>
<section id="união-full_joinxy" class="level3" data-number="6.2.5">
<h3 data-number="6.2.5" class="anchored" data-anchor-id="união-full_joinxy"><span class="header-section-number">6.2.5</span> União (<em>full_join(x,y)</em>)</h3>
<p>Agora considere o caso em que seja necessário preservar todos os indivíduos presentes em ambas as tabelas, mantendo também todas as colunas presentes nas duas tabelas. Nesse caso, o ideal é usar o <em>full_join()</em>, procedendo conforme indicado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>tabela3 <span class="ot">=</span> <span class="fu">full_join</span>(<span class="at">x =</span> tabela1, <span class="at">y =</span> tabela2, <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tabela3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID   X1   X2   X3
1  1    A    E    I
2  2    B    F &lt;NA&gt;
3  3    C    G    J
4  4    D    H &lt;NA&gt;
5  5 &lt;NA&gt; &lt;NA&gt;    K</code></pre>
</div>
</div>
</section>
<section id="exclusão-anti_joinxy" class="level3" data-number="6.2.6">
<h3 data-number="6.2.6" class="anchored" data-anchor-id="exclusão-anti_joinxy"><span class="header-section-number">6.2.6</span> Exclusão (<em>anti_join(x,y)</em>)</h3>
<p>Por fim, considere o caso em que seja necessário gerar uma tabela preservando todos os indivíduos que estão na <em>tabela1</em> mas que não aparecem na <em>tabela2</em>. Nesse caso, o ideal é usar o <em>anti_join()</em>, procedendo conforme indicado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tabela3 <span class="ot">=</span> <span class="fu">anti_join</span>(<span class="at">x =</span> tabela1, <span class="at">y =</span> tabela2, <span class="at">by =</span> <span class="st">"ID"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tabela3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID X1 X2
1  2  B  F
2  4  D  H</code></pre>
</div>
</div>
<p>Note que a coluna <em>X3</em> não aparece no output. Isso é esperado dado que não faz sentido incluir essa coluna na planilha resultante pois <em>X3</em> só está presente na <em>tabela2</em> e os indivíduos contidos no output não estão presentes na <em>tabela2</em>. Como consequência, incluir <em>X3</em> no output resultaria em uma coluna de <em>NA</em>s.</p>
<hr>
</section>
<section id="exemplo-unindo-o-pib-e-a-população" class="level3" data-number="6.2.7">
<h3 data-number="6.2.7" class="anchored" data-anchor-id="exemplo-unindo-o-pib-e-a-população"><span class="header-section-number">6.2.7</span> Exemplo: Unindo o pib e a população</h3>
<p>Acessando o sistema SIDRA do IBGE, podemos encontrar o pib das regiões georgáficas brasileiras para o ano de 2021 em R$ 1000 no link <a href="https://sidra.ibge.gov.br/geratabela?format=br.csv&amp;name=tabela5938.csv&amp;terr=NS&amp;rank=-&amp;query=t/5938/n2/all/v/37/p/last%201/d/v37%200/l/v,p,t" class="uri">https://sidra.ibge.gov.br/geratabela?format=br.csv&amp;name=tabela5938.csv&amp;terr=NS&amp;rank=-&amp;query=t/5938/n2/all/v/37/p/last%201/d/v37%200/l/v,p,t</a>. Também podemos encontrar a população residente estimada no link <a href="https://sidra.ibge.gov.br/geratabela?format=br.csv&amp;name=tabela6579.csv&amp;terr=NS&amp;rank=-&amp;query=t/6579/n2/all/v/all/p/2021/l/v,p,t" class="uri">https://sidra.ibge.gov.br/geratabela?format=br.csv&amp;name=tabela6579.csv&amp;terr=NS&amp;rank=-&amp;query=t/6579/n2/all/v/all/p/2021/l/v,p,t</a>. Vamos importar o pib para o <em>R</em> como um data frame de nome <em>pib</em> e a população como um data frame de nome <em>pop</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pib <span class="ot">=</span> <span class="fu">read.csv</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://sidra.ibge.gov.br/geratabela?format=br.csv&amp;name=tabela5938.csv&amp;terr=NS&amp;rank=-&amp;query=t/5938/n2/all/v/37/p/last%201/d/v37%200/l/v,p,t"</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">3</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">";"</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>pib <span class="ot">=</span> pib[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pib) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Nivel"</span>, <span class="st">"regiao"</span>, <span class="st">"pib"</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">=</span> <span class="fu">read.csv</span>(</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://sidra.ibge.gov.br/geratabela?format=br.csv&amp;name=tabela6579.csv&amp;terr=NS&amp;rank=-&amp;query=t/6579/n2/all/v/all/p/2021/l/v,p,t"</span>,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">3</span>,</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">";"</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">=</span> pop[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pop) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"regiao"</span>, <span class="st">"populacao"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pib)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Nivel       regiao        pib
1    GR        Norte  564063747
2    GR     Nordeste 1243103280
3    GR      Sudeste 4712981720
4    GR          Sul 1559827628
5    GR Centro-Oeste  932165625</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        regiao populacao
1        Norte  18906962
2     Nordeste  57667842
3      Sudeste  89632912
4          Sul  30402587
5 Centro-Oeste  16707336</code></pre>
</div>
</div>
<p>Note que o nome da região está presente em ambas as planilhas. Agora vamos unir as duas planilhas usando o <em>inner_join()</em> criando um data frame de nome <em>pib_regioes</em> usando o nome da região como código de identificação.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>pib_regioes <span class="ot">=</span> <span class="fu">inner_join</span>(<span class="at">x =</span> pib, <span class="at">y =</span> pop, <span class="at">by =</span> <span class="st">"regiao"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pib_regioes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Nivel       regiao        pib populacao
1    GR        Norte  564063747  18906962
2    GR     Nordeste 1243103280  57667842
3    GR      Sudeste 4712981720  89632912
4    GR          Sul 1559827628  30402587
5    GR Centro-Oeste  932165625  16707336</code></pre>
</div>
</div>
<p>Podemos agora adicionar uma nova coluna contendo o pib per capita de cada região, que é a razão entre o pib e a população.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>pib_regioes<span class="sc">$</span>pib_percapita <span class="ot">=</span> pib_regioes<span class="sc">$</span>pib<span class="sc">/</span>pib_regioes<span class="sc">$</span>populacao</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pib_regioes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Nivel       regiao        pib populacao pib_percapita
1    GR        Norte  564063747  18906962      29.83365
2    GR     Nordeste 1243103280  57667842      21.55626
3    GR      Sudeste 4712981720  89632912      52.58093
4    GR          Sul 1559827628  30402587      51.30575
5    GR Centro-Oeste  932165625  16707336      55.79379</code></pre>
</div>
</div>
<p>Podemos também apresentar esses valores em uma figura (conteúdo que será abordado nos próximos capítulos).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  pib_regioes<span class="sc">$</span>pib_percapita, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="st">"cyan"</span>, </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">names.arg =</span> pib_regioes<span class="sc">$</span>regiao, </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Pib per capita das regiões do Brasil"</span>, </span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Região"</span>, </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Pib per capita (R$ 1000,00)"</span>,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">60</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Aula6_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="gerando-estatísticas-com-summarise" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="gerando-estatísticas-com-summarise"><span class="header-section-number">6.3</span> Gerando estatísticas com <em>summarise</em></h2>
<p>Imagine o caso em que seja preciso extrair estatísticas de uma base de dados. Nesse caso, o usuário pode usar a indexação pela coluna para realizar essa tarefa. Por exemplo, para obter o peso médio dos carros na base de dados <em>mtcars</em>, o usuário pode fazer o seguinte:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(mtcars<span class="sc">$</span>wt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.21725</code></pre>
</div>
</div>
<p>No entanto, caso seja necessário calcular essa mesma estatística ou outras estatísticas para múltiplas colunas, a escrita do código pode tornar-se repetitiva e ineficiente. Para contornar esse problema, a biblioteca <em>dplyr</em> disponibiliza a função <em>summarise</em> que é ideal para calcular estatísticas com base em informações de um dado objeto. Para utilizar essa função, o usuário deve proceder com a seguinte lógica:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>nome da base de dados <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    nome da estatistica <span class="dv">1</span> <span class="ot">=</span> estatística <span class="dv">1</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    nome da estatistica <span class="dv">2</span> <span class="ot">=</span> estatística <span class="dv">2</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    nome da estatistica <span class="at">n =</span> n<span class="sc">-</span>ésima estatística</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por exemplo, caso seja necessário calcular o peso médio, o consumo médio e o número total de carros na base <em>mtcars</em>, o usuário deve proceder conforme a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">peso_medio =</span> <span class="fu">mean</span>(wt),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">consumo_medio =</span> <span class="fu">mean</span>(mpg),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">numero_carros =</span> <span class="fu">length</span>(mpg)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  peso_medio consumo_medio numero_carros
1    3.21725      20.09062            32</code></pre>
</div>
</div>
<section id="gerando-estatísticas-para-todas-as-colunas" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="gerando-estatísticas-para-todas-as-colunas"><span class="header-section-number">6.3.1</span> Gerando estatísticas para todas as colunas</h3>
<p>Caso o usuário precise gerar estatísticas para todas as variáveis de uma base de dados, ele pode usar a função <em>summarise_all</em> para escrever o comando em uma única linha em vez de escrever as estatísticas uma a uma na função <em>summarise</em>, o que deixaria o código maior e menos eficiente. A lógica de uso da função <em>summarise_all</em> é a seguinte:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>nome da base de dados <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="at">.funs =</span> <span class="fu">c</span>(<span class="st">"função 1"</span>, <span class="st">"função 2"</span>, ...  <span class="st">"função n"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para exemplificar, imagine que seja preciso calcular a média, o desvio padrão e a mediana de todas as variáveis da base de dados <em>mtcars</em>. Nesse caso, deve-se proceder conforme indicado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="at">.funs =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"median"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mpg_mean cyl_mean disp_mean  hp_mean drat_mean wt_mean qsec_mean vs_mean
1 20.09062   6.1875  230.7219 146.6875  3.596563 3.21725  17.84875  0.4375
  am_mean gear_mean carb_mean   mpg_sd   cyl_sd  disp_sd    hp_sd   drat_sd
1 0.40625    3.6875    2.8125 6.026948 1.785922 123.9387 68.56287 0.5346787
      wt_sd  qsec_sd     vs_sd     am_sd   gear_sd carb_sd mpg_median
1 0.9784574 1.786943 0.5040161 0.4989909 0.7378041  1.6152       19.2
  cyl_median disp_median hp_median drat_median wt_median qsec_median vs_median
1          6       196.3       123       3.695     3.325       17.71         0
  am_median gear_median carb_median
1         0           4           2</code></pre>
</div>
</div>
</section>
<section id="gerando-estatísticas-para-colunas-específicas" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="gerando-estatísticas-para-colunas-específicas"><span class="header-section-number">6.3.2</span> Gerando estatísticas para colunas específicas</h3>
<p>Caso as mesmas estatísticas devam ser aplicadas apenas a uma parte das variáveis da base de dados, então provavelmente seja mais eficiente usar a função <em>summarise_at</em>. Essa função permite que o usuário indique as variáveis e as estatísticas que devem ser calculadas em uma única linha sem a necessidade de repetir os métodos de cálculo das estatísticas com o <em>summarise</em>. A lógica de uso do <em>summarise_at</em> está delimitada a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>{r, eval<span class="ot">=</span><span class="cn">FALSE</span>}</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>nome da base de dados <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.vars =</span> <span class="fu">c</span>(<span class="st">"variável 1"</span>, <span class="st">"variável 2"</span>, ...  <span class="st">"variável n"</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.funs =</span> <span class="fu">c</span>(<span class="st">"função 1"</span>, <span class="st">"função 2"</span>, ...  <span class="st">"função n"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para exemplificar, suponha que seja necessário calcuar a média, o desvio padrão e a mediana das colunas <em>mpg</em>, <em>wt</em> e <em>qseq</em> da base de dados <em>mtcars</em>. Nesse caso, o usuário deve proceder conforme a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.vars =</span> <span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"wt"</span>, <span class="st">"qsec"</span>),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.funs =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"median"</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mpg_mean wt_mean qsec_mean   mpg_sd     wt_sd  qsec_sd mpg_median wt_median
1 20.09062 3.21725  17.84875 6.026948 0.9784574 1.786943       19.2     3.325
  qsec_median
1       17.71</code></pre>
</div>
</div>
<p>Caso existam valores <em>NAs</em> na base de dados, o usuário pode adicionar o <em>na.rm = TRUE</em> antes de fechar o parênteses principal da função, ou seja:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.vars =</span> <span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"wt"</span>, <span class="st">"qsec"</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.funs =</span> <span class="fu">c</span>(<span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"median"</span>),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mpg_mean wt_mean qsec_mean   mpg_sd     wt_sd  qsec_sd mpg_median wt_median
1 20.09062 3.21725  17.84875 6.026948 0.9784574 1.786943       19.2     3.325
  qsec_median
1       17.71</code></pre>
</div>
</div>
</section>
<section id="gerando-estatísticas-condicionais" class="level3" data-number="6.3.3">
<h3 data-number="6.3.3" class="anchored" data-anchor-id="gerando-estatísticas-condicionais"><span class="header-section-number">6.3.3</span> Gerando estatísticas condicionais</h3>
<p>Imagine o caso em que seja preciso calcular uma estatística específica apenas para as variáveis que atendam a uma dada condição. Por exemplo, imagine que seja necessário calcular a média apenas para as colunas que tenham elementos numéricos. Nesse caso, o usuário pode usar a função <em>summarise_if</em>, da biblioteca <em>dpplyr</em>. Essa função permite que as estatísticas desejadas sejam obtidas apenas para as variáveis que atendam a uma dada condição especificada pelo usuário. Essa condição especificada precisa, contudo, advir de uma função com output <em>TRUE</em> ou <em>FALSE</em>, de modo que as estatísticas serão calculadas para as variáveis que obedecerem a condição de afirmação. Para usar o <em>summarise_if</em>, o usuário deve seguir a seguinte lógica:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>nome da base de dados <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_if</span>(condição dada por função, <span class="at">.funs =</span> <span class="fu">c</span>(<span class="st">"estatística"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para exemplificar, considere que seja necessário calcular a média, o desvio padrão e a mediana apenas das variáveis da base de dados <em>mtcars</em> que possuem soma maior que 100. Nesse caso, é preciso criar uma função que especifique essa condição e aplicá-la no <em>summarise_if.</em> Esse procedimento é demonstrado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="cf">function</span>(x){</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">&gt;</span> <span class="dv">100</span>){</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_if</span>(f, <span class="at">.funs =</span> <span class="fu">c</span>(<span class="st">"mean"</span>,<span class="st">"sd"</span>, <span class="st">"median"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  disp_mean  hp_mean  disp_sd    hp_sd disp_median hp_median
1  230.7219 146.6875 123.9387 68.56287       196.3       123</code></pre>
</div>
</div>
</section>
</section>
<section id="criando-variáveis-mutate" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="criando-variáveis-mutate"><span class="header-section-number">6.4</span> Criando Variáveis (<em>mutate</em>)</h2>
<p>Nos primeiros capítulos vimos que é possível adicionar variáveis em um objeto por meio da indexação. Por exemplo, usando a base sobre carros <em>mtcars</em>, se quisermos adicionar uma coluna de nome <em>cambio</em> com valor “manual” se <em>am = 0</em> e “automatico” se <em>am = 1</em>, poderíamos fazer:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>mtcars<span class="sc">$</span>manual <span class="ot">=</span> <span class="fu">ifelse</span>(mtcars<span class="sc">$</span>am <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"manual"</span>, <span class="st">"automatico"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarmente, poderíamos fazer essa mesma tarefa usando a indexação pelo nome da coluna:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>mtcars[,<span class="st">"cambio"</span>] <span class="ot">=</span> <span class="fu">ifelse</span>(mtcars[,<span class="st">"am"</span>] <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"manual"</span>, <span class="st">"automatico"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Esses procedimentos são perfeitamente válidos e funcionam de maneira irrestrita. Porém, note que cada coluna adicionada precisa ser criada em uma linha específica. Note também que a indexação sempre precisa ser informada, tornando a escrita repetitiva e ineficiente. Para melhorar a eficiência da escrita, a biblioteca <em>dplyr</em> disponibiliza uma função nomeada <em>mutate</em>. Essa função permite que múltiplas colunas sejam criadas sem a necessidade de informar a indexação em cada linha de comando. Para melhorar o seu uso, recomenda-se que a função <em>mutate</em> seja usada em conjunto com a função <em>pip</em>, o que permite que a linguagem <em>R</em> reconheça as indexações das colunas sem a necessidade de declará-las. A usuabilidade dessa função segue conforme a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>nome da base de dados <span class="sc">%&gt;%</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    nome da coluna <span class="at">criada  =</span> operação para criar a coluna,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    nome da outra coluna <span class="at">criada =</span> operação para criar mais uma coluna,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    nome da outra coluna <span class="at">criada =</span> operação para criar mais uma coluna</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Por exemplo, para adicionarmos a coluna <em>cambio</em> especificada anteriormente na base de carros <em>mtcars</em>, podemos proceder conforme a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cambio =</span> <span class="fu">ifelse</span>(am <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"automatico"</span>, <span class="st">"manual"</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb     manual
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4 automatico
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4 automatico
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1 automatico
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1     manual
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2     manual
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1     manual
                      cambio
Mazda RX4         automatico
Mazda RX4 Wag     automatico
Datsun 710        automatico
Hornet 4 Drive        manual
Hornet Sportabout     manual
Valiant               manual</code></pre>
</div>
</div>
<p>Note que agora já não é mais necessário utilizar o cifrão ou indexar pelo nome das colunas.</p>
<section id="adicionando-variáveis-multicategóricas-mutate-case_when" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="adicionando-variáveis-multicategóricas-mutate-case_when"><span class="header-section-number">6.4.1</span> Adicionando variáveis multicategóricas (<em>mutate + case_when</em>)</h3>
<p>A função <em>ifelse</em> é bastante útil para usar em conjunto com o mutate para gerar variáveis de duas categorias, uma vez que essa função baseia-se nas condições de afirmação e negação. Contudo, quando se trata de variáveis com múltiplas categorias, o <em>ifelse</em> pode ser complicado e ineficiente. Para contornar essa dificuldade, a biblioteca <em>dplyr</em> disponibiliza a função <em>case_when</em> que permite que o usuário realize operações com múltiplas condições ao mesmo tempo. De maneira rústica, o <em>case_when</em> funciona como um <em>ifelse</em> agrupado para múltiplas condições de afirmação e negação. Seu método de uso deve seguir as seguintes propriedades.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">case_when</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  condição para a categoria <span class="dv">1</span> <span class="sc">~</span> resposta para a categoria <span class="dv">1</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  condição para a categoria <span class="dv">2</span> <span class="sc">~</span> resposta para a categoria <span class="dv">2</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  condição para a categoria <span class="dv">3</span> <span class="sc">~</span> resposta para a categoria <span class="dv">3</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  ...</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> resposta para o caso contrário</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para exemplificar, suponha que queremos adicionar na base de dados <em>mtcars</em> uma coluna de nome <em>potencia</em> classificando a potência do carro conforme o número de cilindros, seguindo as categorias listadas a seguir:</p>
<ul>
<li><p>Potência baixa -&gt; Carros com 4 cilindros.</p></li>
<li><p>Potência média: Carros com 6 cilindros.</p></li>
<li><p>Potência alta: Carros com 8 cilindros.</p></li>
</ul>
<p>Nesse caso, devemos proceder conforme a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">potencia =</span> <span class="fu">case_when</span>(</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>      cyl <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Potência baixa"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>      cyl <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Potência média"</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Potência alta"</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb     manual
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4 automatico
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4 automatico
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1 automatico
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1     manual
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2     manual
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1     manual
                      cambio       potencia
Mazda RX4         automatico Potência média
Mazda RX4 Wag     automatico Potência média
Datsun 710        automatico Potência baixa
Hornet 4 Drive        manual Potência média
Hornet Sportabout     manual  Potência alta
Valiant               manual Potência média</code></pre>
</div>
</div>
</section>
</section>
<section id="filtrando-valores-nas-colunas" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="filtrando-valores-nas-colunas"><span class="header-section-number">6.5</span> Filtrando valores nas colunas</h2>
<p>Nos capítulos anteriores vimos que é possível apagar ou manter valores nas colunas usando a indexação. Por exemplo, caso seja preciso apagar os carros com câmbio manual (<em>am = 0</em>) na base <em>mtcars</em> e manter apenas os carros com câmbio automático (<em>am = 1</em>), podemos proceder conforme a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> mtcars[mtcars<span class="sc">$</span>am <span class="sc">==</span> <span class="dv">1</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>No entanto, o uso da indexação para filtrar valores pode ser complicado e ineficiente quando é necessário aplicar múltiplass condições de escolha de valores. Para contornar esse detalhe, a biblioteca <em>dplyr</em> disponibiliza a função <em>filter</em> que permite que o usuário selecione ou remova valores dos objetos com múltiplas condições de seleção de valores sem a necessidade de usar a indexação. O uso dessa função deve seguir as propriedades listadas a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>nome do objeto <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    primeira condição de seleção ou remoção de valor,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    segunda condição de seleção ou remoção de valor,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    terceira condição de seleção ou remoção de valor,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    n<span class="sc">-</span>ésima condição de seleção ou remoção de valor</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para exemplificar, considere que seja necessário preservar na base de dados <em>mtcars</em> apenas os carros com câmbio automático (<em>am = 1</em>) que tenham seis cilindros (<em>cyl = 6</em>), que tenham pelo menos quatro carburadores <span class="math inline">\((carb 4 \geq 6)\)</span> e que pesem mais de duas toneladas <span class="math inline">\((wt&gt;2)\)</span>. Nesse caso, devemos proceder conforme a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    am <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    cyl <span class="sc">==</span> <span class="dv">6</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    carb <span class="sc">&gt;=</span> <span class="dv">4</span>,</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    wt <span class="sc">&gt;</span> <span class="dv">2</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               mpg cyl disp  hp drat    wt  qsec vs am gear carb     manual
Mazda RX4     21.0   6  160 110 3.90 2.620 16.46  0  1    4    4 automatico
Mazda RX4 Wag 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4 automatico
Ferrari Dino  19.7   6  145 175 3.62 2.770 15.50  0  1    5    6 automatico
                  cambio
Mazda RX4     automatico
Mazda RX4 Wag automatico
Ferrari Dino  automatico</code></pre>
</div>
</div>
</section>
<section id="selecionando-colunas-na-planilha-select" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="selecionando-colunas-na-planilha-select"><span class="header-section-number">6.6</span> Selecionando colunas na planilha (<em>select</em>)</h2>
<p>Em muitas ocasiões, algumas colunas de uma base de dados não são de interesse do economista ou não têm utilidade na tarefa designada. Por exemplo, se o economista precisa computar o pib per capita, ele precisa apenas do pib e da população, e quaisquer outras colunas presentes na planilha de informações podem ser desconsideradas. A tarefa de deletar essas colunas pode ser feita usando a indexação, porém, para facilitar essa tarefa, a biblioteca <em>dplyr</em> disponibiliza a função <em>select</em>, que permite que o usuário preserve na base de dados apenas aquelas colunas do seu interesse sem a necessidade de usar a indexação, reduzindo o número de linhas do código e melhorando a sua eficiência.</p>
<p>A função <em>select</em> possui as seguintes propriedades de uso:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>nome da base de dados <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(nomes das colunas que devem permanecer na planilha separados por vírgula)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ou</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>nome da base de dados <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>nomes das colunas que devem desaparecer da planilha separados por vírgula)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para exemplificar, considere a base de dados <em>mtcars</em> e suponha que só seja necessário usar as colunas <em>am, mpg</em> e <em>wt</em>, de modo que as demais colunas podem ser deletadas. Usando a função <em>select</em>, podemos fazer essa tarefa procedendo conforme indicado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(am, mpg, wt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    am  mpg    wt
Mazda RX4            1 21.0 2.620
Mazda RX4 Wag        1 21.0 2.875
Datsun 710           1 22.8 2.320
Hornet 4 Drive       0 21.4 3.215
Hornet Sportabout    0 18.7 3.440
Valiant              0 18.1 3.460
Duster 360           0 14.3 3.570
Merc 240D            0 24.4 3.190
Merc 230             0 22.8 3.150
Merc 280             0 19.2 3.440
Merc 280C            0 17.8 3.440
Merc 450SE           0 16.4 4.070
Merc 450SL           0 17.3 3.730
Merc 450SLC          0 15.2 3.780
Cadillac Fleetwood   0 10.4 5.250
Lincoln Continental  0 10.4 5.424
Chrysler Imperial    0 14.7 5.345
Fiat 128             1 32.4 2.200
Honda Civic          1 30.4 1.615
Toyota Corolla       1 33.9 1.835
Toyota Corona        0 21.5 2.465
Dodge Challenger     0 15.5 3.520
AMC Javelin          0 15.2 3.435
Camaro Z28           0 13.3 3.840
Pontiac Firebird     0 19.2 3.845
Fiat X1-9            1 27.3 1.935
Porsche 914-2        1 26.0 2.140
Lotus Europa         1 30.4 1.513
Ford Pantera L       1 15.8 3.170
Ferrari Dino         1 19.7 2.770
Maserati Bora        1 15.0 3.570
Volvo 142E           1 21.4 2.780</code></pre>
</div>
</div>
<p>Repare que todas as colunas que não foram especificadas no parênteses foram deletadas da planilha.</p>
</section>
<section id="separando-valores-por-um-separador-comum" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="separando-valores-por-um-separador-comum"><span class="header-section-number">6.7</span> Separando valores por um separador comum</h2>
<p>Em alguns casos, uma coluna específica possui duas informações que estão delimitadas em um único valor. Por exemplo, o IBGE identifica os municípios por um código de identificação composto por sete números. Desses sete números, os dois primeiros correspondem ao código da unidade da federação, isto é, na mesma coluna é possível identificar o estado e o município. No entanto, para identificar o estado em uma coluna é preciso separara esses valores do código do município.</p>
<p>Quando esses dois valores estão separados por um separador comum, é possível criar colunas adicionais contendo cada valor específico por meio da função <a href="https://tidyr.tidyverse.org/reference/separate.html"><em>separate</em></a>da biblioteca <em>tidyr</em>. Nesse caso, basta indicar qual coluna possui a informação, informar o nome das novas colunas que serão criadas e o separador comum. Para exemplificar, considere a seguinte planilha:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2 =</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="fu">sample</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">26</span>], <span class="dv">10</span>), <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">10</span>), <span class="at">sep =</span> <span class="st">"-"</span>))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   x1   x2
1   1 Y-59
2   2 D-14
3   3 Z-95
4   4 Q-40
5   5 N-10
6   6 A-45
7   7 G-38
8   8 R-15
9   9 P-56
10 10 B-76</code></pre>
</div>
</div>
<p>Note que a coluna <span class="math inline">\(x_2\)</span> possui dois valores separados por um hífen. Suponha que precisamos criar duas novas colunas, de nome <span class="math inline">\(x_3\)</span> e <span class="math inline">\(x_4\)</span> contendo esses valores separadamente. Nesse caso, o ideal é usar a função separate, procedendo de acordo com o código a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">separate</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> x2, <span class="co"># Coluna que será separada</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"x3"</span>, <span class="st">"x4"</span>), <span class="co"># nomes das novas colunas que serão criadas</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">"-"</span>, <span class="co"># separador comum</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">remove =</span> <span class="cn">FALSE</span> <span class="co"># TRUE se quiser remover a coluna x2 e FALSE caso contrário</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   x1   x2 x3 x4
1   1 Y-59  Y 59
2   2 D-14  D 14
3   3 Z-95  Z 95
4   4 Q-40  Q 40
5   5 N-10  N 10
6   6 A-45  A 45
7   7 G-38  G 38
8   8 R-15  R 15
9   9 P-56  P 56
10 10 B-76  B 76</code></pre>
</div>
</div>
</section>
<section id="agrupando-valores-group_by" class="level2" data-number="6.8">
<h2 data-number="6.8" class="anchored" data-anchor-id="agrupando-valores-group_by"><span class="header-section-number">6.8</span> Agrupando valores (<em>group_by</em>)</h2>
<p>Frequentemente os economistas precisam agrupar valores para obter indicadores ou variáveis agregadas. Por exemplo, imagine o caso em que uma pesquisa amostral com consumidores do Brasil mostre os gastos com consumo de carne e que um economista precise calcular a média de gasto com carne para cada estado do Brasil. Nesse caso, é preciso agrupar os dados da pesquisa por estado e efetuar o cálculo da média por cada grupo. Em outro exemplo, imagine o caso em que tenhamos o PIB municipal ao longo de dez anos e queiramos calcular o PIB estadual para cada ano. Nesse caso, precisaremos agrupar os dados ao nível de estado e ano e em seguida somar o PIB dos municípios dentro de cada estado agrupado.</p>
<p>Para facilitar esse processo, a biblioteca <em>dplyr</em> disponibiliza a função <em>group_by</em> que agrupa os dados pelas colunas indicadas pelo usuário e permite o cálculo de estatísticas e a criação de novas colunas com os valores agrupados. Essa função geralmente é usada de duas maneiras, conforme listado a seguir:</p>
<section id="agrupando-toda-a-base-de-dados-group_by-summarise" class="level3" data-number="6.8.1">
<h3 data-number="6.8.1" class="anchored" data-anchor-id="agrupando-toda-a-base-de-dados-group_by-summarise"><span class="header-section-number">6.8.1</span> (1) agrupando toda a base de dados (<em>group_by + summarise</em>)</h3>
<p>Se o usuário quer que toda a base de dados seja agrupada em uma única base de dados contendo apenas as colunas criadas com os valores agrupados, então o ideal é usar o <em>group_by</em> em conjunto com a função <em>summarise</em>. O layout de uso dessas funções deve seguir os seguintes procedimentos:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>nome da base de dados <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nome das colunas indicando o nível de agrupamento) <span class="sc">%&gt;%</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    nome da coluna <span class="at">criada =</span> estatística para criar a coluna</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para exemplificar, imagine que precisamos calcular o peso médio dos carros de acordo com o número de cilindros na base <em>mtcars</em>. Essa tarefa pode ser executada com o seguinte procedimento:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">peso_medio =</span> <span class="fu">mean</span>(wt)</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 2
    cyl peso_medio
  &lt;dbl&gt;      &lt;dbl&gt;
1     4       2.29
2     6       3.12
3     8       4.00</code></pre>
</div>
</div>
<p>Note que todas as colunas desapareceram, permanecendo no data frame apenas a coluna de agrupamento (<em>cyl</em>) e a coluna com o resultado da estatística agrupada (<em>peso_medio</em>). Esse é o padrão de output quando se concilia as funções <em>group_by</em> e <em>summarise</em>.</p>
</section>
<section id="preservando-toda-a-base-de-dados-group_by-mutate" class="level3" data-number="6.8.2">
<h3 data-number="6.8.2" class="anchored" data-anchor-id="preservando-toda-a-base-de-dados-group_by-mutate"><span class="header-section-number">6.8.2</span> (2) Preservando toda a base de dados (<em>group_by + mutate</em>)</h3>
<p>Nesse caso, todas as linhas e todas as colunas da base de dados são preservadas e uma nova coluna é adicionada com os valores agrupados. Esse procedimento é ideal para o caso em que se necessita apenas de uma nova coluna com dados agrupados para uma dada categoria. Para esses casos, a função <em>group_by</em> deve ser usada em conjunto com a função <em>mutate</em> em vez da função <em>summarise</em>.</p>
<p>Para exemplificar, considere o mesmo caso do exemplo anterior, porém, com a diferença de que agora precisamos manter todas as linhas e todas as colunas da base de dados. Nesse caso, deve-se proceder conforme indicado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">peso_medio =</span> <span class="fu">mean</span>(wt)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dt[<span class="dv">3</span><span class="sc">:</span><span class="dv">12</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 x 10
   disp    hp  drat    wt  qsec    vs    am  gear  carb manual    
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
1   160   110  3.9   2.62  16.5     0     1     4     4 automatico
2   160   110  3.9   2.88  17.0     0     1     4     4 automatico
3   108    93  3.85  2.32  18.6     1     1     4     1 automatico
4   258   110  3.08  3.22  19.4     1     0     3     1 manual    
5   360   175  3.15  3.44  17.0     0     0     3     2 manual    
6   225   105  2.76  3.46  20.2     1     0     3     1 manual    </code></pre>
</div>
</div>
</section>
</section>
<section id="transformando-colunas-em-variáveis-pivot_wider" class="level2" data-number="6.9">
<h2 data-number="6.9" class="anchored" data-anchor-id="transformando-colunas-em-variáveis-pivot_wider"><span class="header-section-number">6.9</span> Transformando colunas em variáveis (<em>pivot_wider</em>)</h2>
<p>Imagine que você se depare com a situação em que seja preciso transformar em variáveis as categorias especificadas em uma coluna. Por exemplo, observe a coluna <span class="math inline">\(x_2\)</span> na tabela a seguir:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\(x_1\)</span></th>
<th><span class="math inline">\(x_2\)</span></th>
<th><span class="math inline">\(x_3\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>A</td>
<td>5</td>
</tr>
<tr class="even">
<td>1</td>
<td>C</td>
<td>1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>B</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>C</td>
<td>1</td>
</tr>
<tr class="odd">
<td>2</td>
<td>B</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>A</td>
<td>5</td>
</tr>
<tr class="odd">
<td>3</td>
<td>A</td>
<td>5</td>
</tr>
<tr class="even">
<td>3</td>
<td>B</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>C</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>Imagine que seja preciso gerar 3 colunas com os valores da coluna <span class="math inline">\(x_3\)</span> referentes a cada elemento da coluna <span class="math inline">\(x_2\)</span> (A, B e C), aumentando a quantidade de colunas da tabela conforme delimitado a seguir:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\(x_1\)</span></th>
<th>A</th>
<th>B</th>
<th>C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>5</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>5</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5</td>
<td>1</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>Essa tarefa é bastante comum quando os dados estão empilhados (painel de dados) e os economistas precisam trabalhar com uma planilha desagregada (tipo <em>crossection</em>). Para esta tarefa, a biblioteca <em>tidyr</em> disponibiliza a função <a href="https://tidyr.tidyverse.org/reference/pivot_wider.html"><em>pivot_wider</em></a><em>,</em> que facilita a execução dessa tarefa. Essa função possui a seguinte especificação de uso:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_wider</span>(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_from =</span> nome da coluna que terá os seus valores convertidos em variáveis,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_from =</span> nome da coluna que irá compor os valores da coluna especificada no parâmetro names_from</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para exemplificar, vamos considerar o caso do exemplo da tabela especificada.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2 =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>),</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x3 =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">1</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  x1 x2 x3
1  1  A  5
2  1  C  1
3  1  B  3
4  2  C  1
5  2  B  3
6  2  A  5
7  3  A  5
8  3  B  3
9  3  C  1</code></pre>
</div>
</div>
<p>Agora vamos usar a função <em>pivot_wider</em> para transformar os dados agrupados em uma planilha <em>crossection</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>dt1 <span class="ot">=</span> dt <span class="sc">%&gt;%</span> </span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> x2, <span class="at">values_from =</span> x3)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>dt1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 4
     x1     A     C     B
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     5     1     3
2     2     5     1     3
3     3     5     1     3</code></pre>
</div>
</div>
<p>Nota: A coluna especificada no parâmetro <em>names_from</em> deve ser da classe <em>character</em>.</p>
</section>
<section id="transformando-variáveis-em-colunas-pivot_longer" class="level2" data-number="6.10">
<h2 data-number="6.10" class="anchored" data-anchor-id="transformando-variáveis-em-colunas-pivot_longer"><span class="header-section-number">6.10</span> Transformando variáveis em colunas (<em>pivot_longer</em>)</h2>
<p>Assim como os economistas precisam frequentemente transformar painéis de dados em planilhas <em>crossection</em>, vez ou outra é preciso fazer a tarefa inversa e transformar planilhas <em>crossection</em> em painéis de dados empilhados. Para esta tarefa, a biblioteca <em>tidyr</em> disponibiliza a função <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html"><em>pivot_longer</em></a>, que permite que um conjunto de colunas específicas sejam empilhadas em uma única coluna, reduzindo a largura e aumentando o comprimento das tabelas. Essa função possui as seguintes propriedades de uso:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pivot_longer</span>(</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">cols =</span> colunas usadas na transformação da planilha,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">names_to =</span> nome da nova <span class="fu">coluna</span> (entre aspas) que será criada com os nomes das antigas colunas,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">values_to =</span> nome da nova <span class="fu">coluna</span> (entre aspas) que será criada com os dados agrupados</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para exemplificar, vamos retornar a planilha gerada anteriormente (<em>dt1</em>) na planilha original (<em>dt</em>) com dados <em>crossection</em>. Nesse caso, <em>A, B</em> e <em>C</em> são as colunas que serão empilhadas, de modo que o parâmetro <em>names_to</em> deve receber o valor <em>x1</em> e o parâmetro <em>values_to</em> deve receber o valor <em>x2</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>dt2 <span class="ot">=</span> dt1 <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(A, B, C),</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"x2"</span>,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"x3"</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>dt2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 x 3
     x1 x2       x3
  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1     1 A         5
2     1 B         3
3     1 C         1
4     2 A         5
5     2 B         3
6     2 C         1
7     3 A         5
8     3 B         3
9     3 C         1</code></pre>
</div>
</div>
<p>Note que, apesar de os valores não estarem posicionados na mesma ordem da planilha <em>dt</em>, eles estão distribuídos igualmente entre os indivíduos conforme a planilha correspondente.</p>
<hr>
</section>
<section id="exemplo-gerando-uma-tabela-de-estatísticas-descritivas" class="level2" data-number="6.11">
<h2 data-number="6.11" class="anchored" data-anchor-id="exemplo-gerando-uma-tabela-de-estatísticas-descritivas"><span class="header-section-number">6.11</span> Exemplo: Gerando uma tabela de estatísticas descritivas</h2>
<p>Nos capítulos anteriores foi demonstrado como criar uma tabela de estatísticas descritivas usando apenas a indexação das colunas e funções nativas da linguagem <em>R</em>. O roteiro para criar essa tabela foi bastante longo e o código de execução foi bastante ineficiente. Usando as bibliotecas de manipulação de dados <em>dplyr</em> e <em>tidyr</em> é possível executar essa mesma tarefa com maior eficiência e com menos trabalho.</p>
<p>Para exemplificar, vamos criar uma tabela de estatísticas descritivas de todas as colunas da base de dados <em>mtcars</em>, contendo o número de observações, a média, o desvio padrão, o valor mínimo e o valor máximo. Esse procedimento pode ser feito conforme demonstrado a seguir:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="at">.funs =</span> <span class="fu">c</span>(<span class="st">"length"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">everything</span>(), <span class="co"># selecionando todas as colunas</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"variavel"</span>,</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"valorEstatistica"</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(variavel, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"coluna"</span>, <span class="st">"estatistica"</span>), <span class="at">sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="st">"estatistica"</span>,</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">"valorEstatistica"</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variavel =</span> coluna,</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Observacoes=</span> length,</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Media =</span> mean,</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Desvio_padrao =</span> sd,</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Minino =</span> min,</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Maximo =</span> max</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 x 6
   Variavel Observacoes   Media Desvio_padrao Minino Maximo
   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 mpg               32  20.1           6.03   10.4   33.9 
 2 cyl               32   6.19          1.79    4      8   
 3 disp              32 231.          124.     71.1  472   
 4 hp                32 147.           68.6    52    335   
 5 drat              32   3.60          0.535   2.76   4.93
 6 wt                32   3.22          0.978   1.51   5.42
 7 qsec              32  17.8           1.79   14.5   22.9 
 8 vs                32   0.438         0.504   0      1   
 9 am                32   0.406         0.499   0      1   
10 gear              32   3.69          0.738   3      5   
11 carb              32   2.81          1.62    1      8   </code></pre>
</div>
</div>
<hr>
</section>
<section id="exercício" class="level2" data-number="6.12">
<h2 data-number="6.12" class="anchored" data-anchor-id="exercício"><span class="header-section-number">6.12</span> Exercício</h2>
<p>O link a seguir possui uma planilha excel (.xlsx) com o valor da produção agrícola dos municípios do Brasil no ano de 2024 em R$ 1.000,00.</p>
<ul>
<li><a href="https://sidra.ibge.gov.br/geratabela?format=xlsx&amp;name=tabela5457.xlsx&amp;terr=NC&amp;rank=-&amp;query=t/5457/n6/all/v/215/p/last%201/c782/0/l/v,p%2Bc782,t" class="uri">https://sidra.ibge.gov.br/geratabela?format=xlsx&amp;name=tabela5457.xlsx&amp;terr=NC&amp;rank=-&amp;query=t/5457/n6/all/v/215/p/last%201/c782/0/l/v,p%2Bc782,t</a></li>
</ul>
<p>O link a seguir contém uma planilha excel (.xlsx) com a área plantada (em hectares) dos municípios do estdo do Brasil em 2024.</p>
<ul>
<li><a href="https://sidra.ibge.gov.br/geratabela?format=xlsx&amp;name=tabela5457.xlsx&amp;terr=NC&amp;rank=-&amp;query=t/5457/n6/all/v/8331/p/last%201/c782/0/l/v,p%2Bc782,t" class="uri">https://sidra.ibge.gov.br/geratabela?format=xlsx&amp;name=tabela5457.xlsx&amp;terr=NC&amp;rank=-&amp;query=t/5457/n6/all/v/8331/p/last%201/c782/0/l/v,p%2Bc782,t</a></li>
</ul>
<p>Responda:</p>
<p>(i) Revise o capítulo anterior e utilize a biblioteca <em>openxlsx</em> para importar as duas planilhas para a linguagem <em>R</em>.</p>
<p>(ii) Una as duas planilhas pelo código do município.</p>
<p>(iii) Crie uma nova coluna de nome <em>produtividade</em> mostrando a produtividade da terra (valor da produção por hectare).</p>
<p>(iv) Agrupe por estado e calcule a média, o desvio padrão o mínimo e o máximo da produtividade da terra para cada unidade da Federação.</p>
<p>(v) Preserve na base de dados resultante apenas os estados da região Nordeste.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Aula5.html" class="pagination-link" aria-label="Leitura de dados">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Leitura de dados</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>